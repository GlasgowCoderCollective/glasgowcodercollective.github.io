<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/css?family=Questrial" rel="stylesheet">
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/brands.css"
        integrity="sha384-7xAnn7Zm3QC1jFjVc1A6v/toepoG3JXboQYzbM0jrPzou9OFXm/fY6Z/XiIebl/k" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/fontawesome.css"
        integrity="sha384-ozJwkrqb90Oa3ZNb+yKFW2lToAWYdTiF1vt8JiH5ptTGHTGcN7qdoR1F95e0kYyG" crossorigin="anonymous">
    <title>glasgowCoderCollective</title>
</head>

<body>
    <div class="container">
        <header>
            <img src="/img/gcclogo.png" style="width: 100px; height: 100px;" alt="gcc logo">
            <div class="title">
                <h1 style="display: inline;">glasgowCoderCollective</h1>
            </div>
            <nav>
                <ul class="navbar">
                    <a href="/">
                        <li class="navitem">Home</li>
                    </a>
                </ul>
            </nav>
            <img id="avatar" src="/img/user.png"
                style="width: 50px; height: 50px; border-radius: 50%; border: 5px solid white; margin-top: 1em;"
                alt="Avatar">
        </header>
        <main>
            <div class="uploadsuccess options hidden">
                File has been uploaded Successfully :)
            </div>
            <div class="uploadfail options hidden">
                File could not be uploaded :(
            </div>
            <div class="options">
                <form class="form-group" action="/api/resources/upload" method="post" enctype="multipart/form-data">
                    <input class="form-control" type="file" name="resource">
                    <input class="form-control" type="submit" value="Upload">
                </form>
            </div>
            <div class="resourcesList">
                <h1>Resources</h1>
                <ul class="resources"></ul>
            </div>
        </main>
        <footer>
            <h1>Join us!</h1>
            <div class="links">
                <a href="https://www.facebook.com/groups/136019366986372/">
                    <i class="fab fa-facebook-square social"></i>
                </a>
                <a href="https://github.com/GlasgowCoderCollective/">
                    <i class="fab fa-github social"></i>
                </a>
                <a href="https://join.slack.com/t/glacodercollective/shared_invite/enQtNDEzMDg4NDc2ODE2LTg0MjQwMjUxOGM1MDgzNmNhZTBjMDRlZGUxNWI2NDY2NTQyNWYxZDU3YTVjYzM3NzI0NGUxMTQ4MzgxYjlkNTY"
                    class="slack-btn" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-slack social"></i>
                </a>
            </div>
            <div class="tribute">In memory of Handsome Neil, who we sadly lost in December 2017</div>
        </footer>
    </div>

    <script>
        fetch('/api/resources/list')
            .then(response => response.json())
            .then((data) => {
                const { resources } = data;
                const resourceList = document.querySelector('.resources');

                resourceList.innerHTML = '';
                resources.forEach((resource) => {
                    resourceList.innerHTML += `<li><a href="/api/resources/download/${resource.originalFileName}">${resource.originalFileName}</a> - Uploaded by ${resource.uploader}</li>`
                });
            });

        fetch('/api/auth/user')
            .then(response => response.json())
            .then(user => {
                avatar.src = user.data.avatar;
                const successNotification = document.querySelector('.uploadsuccess');
                const failNotification = document.querySelector('.uploadfail');
                const urlParams = new URLSearchParams(window.location.search);
                let result
                if (urlParams.has('success')) {
                    result = urlParams.get('success') === 'true';
                    if (result) {
                        successNotification.classList.remove('hidden');
                    } else {
                        failNotification.classList.remove('hidden');
                    }
                }
            });
    </script>
</body>

</html>